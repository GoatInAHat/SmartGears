<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="concept" name="topic-type"/>
  <meta content="/view/OARX/2025/ENU/" name="helpsystempath"/>
  <meta content="OARX" name="product"/>
  <meta content="2025" name="release"/>
  <meta content="Developer" name="book"/>
  <meta content="AutoCAD-AutoLISP-Tutorials" name="component"/>
  <meta content="25/4/2024" name="created"/>
  <meta content="ACD=2025" name="applies-to"/>
  <meta content="ACAD_E=2025" name="applies-to"/>
  <meta content="AMECH_PP=2025" name="applies-to"/>
  <meta content="ARCHDESK=2025" name="applies-to"/>
  <meta content="BLDSYS=2025" name="applies-to"/>
  <meta content="CIV3D=2025" name="applies-to"/>
  <meta content="MAP=2025" name="applies-to"/>
  <meta content="PLNT3D=2025" name="applies-to"/>
  <meta content="PNID=2025" name="applies-to"/>
  <meta content="STRDET=2025" name="applies-to"/>
  <meta content="UTLDESN=2025" name="applies-to"/>
  <meta content="CSY, DEU, ESP, FRA, HUN, ITA, KOR, PLK, PTB, RUS, CHS, CHT" name="applies-to-languages"/>
  <meta content="TRIDION" name="generatedby"/>
  <meta content="disable" name="user-comments"/>
  <meta content="GUID-209318DE-95C4-40F6-8776-935C8905FDEE" name="workflow-parent-id"/>
  <meta content="general" name="experiencelevel"/>
  <meta content="programmer" name="audience"/>
  <meta content="03/12/2019" name="modified"/>
  <meta content="autolisp" name="topic-subtype"/>
  <meta content="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09" name="topicid"/>
  <meta content="ENU" name="language"/>
  <title>
   Updating Gp:Calculate-and-Draw-Tiles
  </title>
  <link href="../../../../_assets/client-28da4093.css" rel="stylesheet" type="text/css"/>
 </head>
 <body id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09">
  <div class="head">
   <div class="head-block">
    <div class="button-info">
     <span id="infoline">
     </span>
    </div>
    <div class="ancestry">
    </div>
    <div class="head-text">
     <h1>
      Updating Gp:Calculate-and-Draw-Tiles
     </h1>
    </div>
   </div>
  </div>
  <div class="body conbody">
   <div class="section" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-EE3091DB-A559-4857-B73F-56BC70FA2129">
    <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-7874">
     Earlier in this lesson, it was noted that you need to force
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-7B43509A-7192-475A-9086-CAD96188CD35">
      gp:Calculate-and-Draw-Tiles
     </samp>
     to use ActiveX to create objects when invoked from a reactor callback. This means overriding the object creation style (ActiveX,
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-646DCE5B-B347-44E7-8413-033DC6319A5C">
      entmake
     </samp>
     , or
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-F7400E3C-155D-4755-801D-655BF8C8720B">
      command
     </samp>
     ) chosen by the user, if necessary. The code you just updated, in the
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-E354A2B4-A9F9-4695-8FC9-4ECBADEEB74A">
      gp:command-ended
     </samp>
     function, contains the following invocation of the tile drawing routine:
    </p>
    <pre class="pre codeblock prettyprint">(setq tileList (gp:Calculate-and-Draw-Tiles
    ;; path data list without correct tile list.
    NewReactorData
    ;; Object creation function.
    ;; Within a reactor this *MUST* be ActiveX.
    "ActiveX"
   )
)</pre>
    <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-7873">
     Two parameters are passed to
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-E78E81CD-B395-4496-954A-308BC1541A25">
      gp:Calculate-and-Draw-Tiles
     </samp>
     :
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-439F1579-24E1-4882-9C1A-34BD62D0851F">
      NewReactorData
     </samp>
     (which is a list in the form of the original
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-879896CB-ED5C-4139-9410-D0D603FF84DF">
      gp_PathData
     </samp>
     association list) and the string
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-3CAD9186-74DA-463B-9B37-D73D8FE3DDD0">
      "ActiveX"
     </samp>
     (which will set the object creation style). But take a look at the current definition of
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-162E306E-6624-421C-AA2A-3467B1FFFA23">
      gp:Calculate-and-Draw-Tiles
     </samp>
     . (In case you have forgotten, this function is defined in
     <em class="ph i" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-BD7B6DF0-FF0E-45B5-9AA2-3863AEB780A5">
      gpdraw.lsp
     </em>
     .) Here is the part of the function that declares the parameters and local variables:
    </p>
    <pre class="pre codeblock prettyprint">(defun gp:Calculate-and-Draw-Tiles (BoundaryData /
                                    PathLength TileSpace
                                    TileRadius SpaceFilled
                                    SpaceToFill RowSpacing
                                    offsetFromCenter rowStartPoint
                                    pathWidth pathAngle
                                    ObjectCreationStyle TileList)</pre>
    <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-7872">
     Notice only that one parameter is currently specified, and
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-CCD2296B-8526-4984-B012-F06300CC7C47">
      ObjectCreationStyle
     </samp>
     is identified as a local variable. Review how the
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-E687F57E-6555-4330-A0E4-238C75543606">
      ObjectCreationStyle
     </samp>
     variable is set, which is a little farther into the function:
    </p>
    <pre class="pre codeblock prettyprint">(setq ObjectCreationStyle (strcase (cdr (assoc 3 BoundaryData))))</pre>
    <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFDF1B63E01EA74BE1908CA1FEE07159CE-7FF5">
     The
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-60242824-242C-4511-9EF6-208B563D74E4">
      ObjectCreationStyle
     </samp>
     is currently set internally within the function by retrieving the value tucked away in the
     <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-EBAA72EF-206C-4C72-9404-9BDE3ED19161">
      BoundaryData
     </samp>
     variable (the association list). But now you need to be able to override that value.
    </p>
   </div>
   <div class="section" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE6C92BAFEE30F7510-7DB7">
    <h2 class="title sectiontitle">
     To modify gp:Calculate-and-Draw-Tiles to accept an object creation style argument
    </h2>
    <ol class="ol" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WS1A9193826455F5FF18CB41610EC0A2E719-72DD">
     <li class="li" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WS1A9193826455F5FF-7F10494411F03A24F24-1D17">
      Add the
      <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-848FA500-C23D-4194-BE21-DD97A6E25656">
       ObjectCreationStyle
      </samp>
      variable to the function argument.
     </li>
     <li class="li" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WS1A9193826455F5FF-7F10494411F03A24F24-1D16">
      Remove
      <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-3386EDE0-9DE3-4AF8-A44F-EC5665E7A2D3">
       ObjectCreationStyle
      </samp>
      from the local variables.
      <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-7871">
       The
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-E1D31D77-19F4-4F50-9D26-27ECD28455AA">
        defun
       </samp>
       statement for the function should look like the following:
      </p>
      <pre class="pre codeblock prettyprint">(defun gp:Calculate-and-Draw-Tiles (BoundaryData ObjectCreationStyle
                                    / PathLength TileSpace
                                    TileRadius SpaceFilled
                                    SpaceToFile RowSpacing
                                    offsetFromCenter rowStartPoint
                                    pathWidth pathAngle
                                    TileList) ; remove ObjectCreationStyle from locals</pre>
      <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-7870">
       Note that if you declare a variable both as a parameter (before the slash) and as a local variable (after the slash), Visual LISP will point this out to you. For example, if you declare
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-B536C59D-7B64-4579-99A5-660B86FEB2DE">
        ObjectCreationStyle
       </samp>
       as both a parameter and a variable, then use the Visual LISP syntax checking tool on the
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-3C4D1B5E-8F47-4000-9052-3406B6B1B6D0">
        gp:Calculate-and-Draw-Tiles
       </samp>
       function, the following message will appear in the Build Output window:
      </p>
      <pre class="pre codeblock prettyprint">; *** WARNING: same symbol before and after / in arguments list: OBJECTCREATIONSTYLE</pre>
     </li>
     <li class="li" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WS1A9193826455F5FF-7F10494411F03A24F24-1D15">
      Modify the first
      <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-15173961-06C5-4F3B-A705-A1AF51D7194F">
       setq
      </samp>
      expression within
      <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-295DC316-13B6-415C-AF9D-87E12A84A051">
       gp:Calculate-and-Draw-Tiles
      </samp>
      so that it looks like the following:
      <pre class="pre codeblock prettyprint">(setq
   PathLength       (cdr (assoc 41 BoundaryData))
   TileSpace        (cdr (assoc 43 BoundaryData))
   TileRadius       (cdr (assoc 42 BoundaryData))
   SpaceToFill      (- PathLength TileRadius)
   RowSpacing       (* (+ TileSpace (* TileRadius 2.0))
                      (sin (Degrees-&gt;Radians 60))
                    )
   SpaceFilled      RowSpacing
   offsetFromCenter 0.0
   offsetDistance   (+ (* TileRadius 2.0) TileSpace) 2.0)
   rowStartPoint    (cdr (assoc 10 BoundaryData))
   pathWidth        (cdr (assoc 40 BoundaryData))
   pathAngle        (cdr (assoc 50 BoundaryData))
) ;_ end of setq

(if (not ObjectCreationStyle)
  (setq ObjectCreationStyle (strcase (cdr (assoc 3 BoundaryData))))
)</pre>
      <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-786F">
       The original assignment statement for
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-CE318D04-7450-4828-862F-AAC1E28500D9">
        ObjectCreationStyle
       </samp>
       has been removed. The code now checks to see if a value has been provided for
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-3C009F47-6E45-49AB-8477-297B10420161">
        ObjectCreationStyle
       </samp>
       . If
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-D944F4BA-7F06-49D4-8748-131F213F85DA">
        ObjectCreationStyle
       </samp>
       is not set (that is, the value is
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-2125CFDB-EC20-4E17-A144-A6EEB0B1E2BA">
        nil
       </samp>
       ), the function assigns it a value from the
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-F74AE595-7367-40F3-A1CE-8AF30CFB0CD5">
        BoundaryData
       </samp>
       variable.
      </p>
      <p class="p" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__WSFACF1429558A55DE1929BBDFEF458CE1C-786E">
       There is one more series of changes you need to make to
       <samp class="ph codeph" id="GUID-EB766BFB-9F93-4F71-AA13-BC8B6D760D09__GUID-E4AFE698-318E-4472-B75C-E6860C440A0D">
        gp:Calculate-and-Draw-Tiles
       </samp>
       .
      </p>
     </li>
    </ol>
   </div>
  </div>
  <div class="related-links">
   <div class="familylinks">
    <div class="parentlink">
     <strong>
      Parent topic:
     </strong>
     <a class="link" href="Lesson_7_Putting_It_All_Together_Visual_LISP_IDE.html">
      Lesson 7: Putting It All Together (Visual LISP IDE)
     </a>
    </div>
    <div class="previouslink">
     <strong>
      Previous topic:
     </strong>
     <a class="link" href="Coding_the_Command_ended_Function.html">
      Coding the Command-ended Function
     </a>
    </div>
    <div class="nextlink">
     <strong>
      Next topic:
     </strong>
     <a class="link" href="Modifying_Other_Calls_to_Gp_Calculate_and_Draw_Tiles.html">
      Modifying Other Calls to Gp:Calculate-and-Draw-Tiles
     </a>
    </div>
   </div>
  </div>
 </body>
</html>
