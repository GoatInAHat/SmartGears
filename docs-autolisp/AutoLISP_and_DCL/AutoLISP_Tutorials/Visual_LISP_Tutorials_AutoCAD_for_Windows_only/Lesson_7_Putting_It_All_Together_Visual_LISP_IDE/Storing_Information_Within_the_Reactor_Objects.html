<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="concept" name="topic-type"/>
  <meta content="/view/OARX/2025/ENU/" name="helpsystempath"/>
  <meta content="OARX" name="product"/>
  <meta content="2025" name="release"/>
  <meta content="Developer" name="book"/>
  <meta content="AutoCAD-AutoLISP-Tutorials" name="component"/>
  <meta content="25/4/2024" name="created"/>
  <meta content="ACD=2025" name="applies-to"/>
  <meta content="ACAD_E=2025" name="applies-to"/>
  <meta content="AMECH_PP=2025" name="applies-to"/>
  <meta content="ARCHDESK=2025" name="applies-to"/>
  <meta content="BLDSYS=2025" name="applies-to"/>
  <meta content="CIV3D=2025" name="applies-to"/>
  <meta content="MAP=2025" name="applies-to"/>
  <meta content="PLNT3D=2025" name="applies-to"/>
  <meta content="PNID=2025" name="applies-to"/>
  <meta content="STRDET=2025" name="applies-to"/>
  <meta content="UTLDESN=2025" name="applies-to"/>
  <meta content="CSY, DEU, ESP, FRA, HUN, ITA, KOR, PLK, PTB, RUS, CHS, CHT" name="applies-to-languages"/>
  <meta content="TRIDION" name="generatedby"/>
  <meta content="disable" name="user-comments"/>
  <meta content="GUID-209318DE-95C4-40F6-8776-935C8905FDEE" name="workflow-parent-id"/>
  <meta content="general" name="experiencelevel"/>
  <meta content="programmer" name="audience"/>
  <meta content="04/02/2021" name="modified"/>
  <meta content="autolisp" name="topic-subtype"/>
  <meta content="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855" name="topicid"/>
  <meta content="ENU" name="language"/>
  <title>
   Storing Information Within the Reactor Objects
  </title>
  <link href="../../../../_assets/client-28da4093.css" rel="stylesheet" type="text/css"/>
 </head>
 <body id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855">
  <div class="head">
   <div class="head-block">
    <div class="button-info">
     <span id="infoline">
     </span>
    </div>
    <div class="ancestry">
    </div>
    <div class="head-text">
     <h1>
      Storing Information Within the Reactor Objects
     </h1>
    </div>
   </div>
  </div>
  <div class="body conbody">
   <div class="section" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-C0ECCE71-A019-4C5C-A493-4A5B74C4CE0A">
    <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-7892">
     One other important aspect of the application you need to think about is what kind of information to attach to the object reactor that is created for each polyline entity. In Lesson 6, you added code that attached the contents of
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-9090209E-AC6A-4EF9-8F70-5EC5E6AE9E1A">
      gp_PathData
     </samp>
     (the association list) to the reactor. You expanded the data carried within
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-E464F6D8-5C80-4838-AFF2-23EB73ACD5E5">
      gp_PathData
     </samp>
     by adding a new keyed field (100) to the association list. This new sublist is a list of pointers to all the circle entities assigned to a polyline boundary.
    </p>
    <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-7891">
     Because of the work that needs to be done to recalculate the polyline boundary, four additional key values should be added to
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-724B1753-3D9B-4697-92E9-C6E2A7CEC56C">
      gp_pathData
     </samp>
     :
    </p>
    <pre class="pre codeblock prettyprint">;;; StartingPoint                                                  ;
;;; (12 . BottomStartingPoint)      15------------------------14   ;
;;; (15 . TopStartingPoint)         |                          |   ;
;;; EndingPoint                     10    ----pathAngle---&gt;   11   ;
;;; (13 . BottomEndingPoint)        |                          |   ;
;;; (14 . TopEndingPoint)           12------------------------13   ;
;;;                                                                ;</pre>
    <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-7890">
     These ordered points are necessary to recalculate the polyline boundary whenever the user drags a corner grip to a new location. This information already exists within the
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-51BCFE94-CED2-4FA0-891A-47E54D8BF559">
      gp:drawOutline
     </samp>
     function in
     <em class="ph i" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-36101D47-464B-4A5C-A7EA-479E6F8CE938">
      gpdraw.lsp
     </em>
     . But look at the return value of the function. Currently, only the pointer to the polyline object is returned. So you need to do three things:
    </p>
    <ul class="ul" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF18CB41610EC0A2E719-72F1">
     <li class="li" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF-7F10494411F03A24F24-1D27">
      Assemble the perimeter points in the format required.
     </li>
     <li class="li" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF-7F10494411F03A24F24-1D26">
      Modify the function so that it returns the perimeter point lists and the pointer to the polyline.
     </li>
     <li class="li" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF-7F10494411F03A24F24-1D25">
      Modify the
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-019391ED-8888-4AA2-9E52-14E8AECDDA7D">
       C:GPath
      </samp>
      function so that it correctly deals with the new format of the values returned from
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-56A77541-10E3-4CD3-8AA6-C7E2B3AAA39E">
       gp:drawOutline
      </samp>
      .
     </li>
    </ul>
    <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-788F">
     Assembling the perimeter point lists is simple. Look at the code in
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-A503C262-1065-4490-9223-23FEB54097E9">
      gp:drawOutline
     </samp>
     . The local variable
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-B645104A-A803-4FC1-BFE5-44D1EC71E62C">
      p1
     </samp>
     corresponds to the key value 12,
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-5CED402F-52A8-470A-B946-4EE9C80F9357">
      p2
     </samp>
     to 13,
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-205B0139-C0C0-40D8-9D33-E428BD8FFB8E">
      p3
     </samp>
     to 14, and
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-FC12B286-F9C5-454A-B4AC-A215D01EFE63">
      p4
     </samp>
     to 15. You can add the following function call to assemble this information:
    </p>
    <pre class="pre codeblock prettyprint">(setq polyPoints(list	 
  (cons 12 p1)
  (cons 13 p2)
  (cons 14 p3)
  (cons 15 p4)
))</pre>
    <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-788E">
     Modifying the function so that it returns the polyline perimeter points and the polyline pointer is also easy. As the last expression within
     <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-1765C450-29BD-4456-AA25-B3AB848514BB">
      gp:drawOutline
     </samp>
     , assemble a list of the two items of information you want to return.
    </p>
    <pre class="pre codeblock prettyprint">(list pline polyPoints)</pre>
   </div>
   <div class="section" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE6C92BAFEE30F7510-7DBC">
    <h2 class="title sectiontitle">
     To add program logic to save the polyline perimeter points
    </h2>
    <ol class="ol" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF18CB41610EC0A2E719-72EF">
     <li class="li" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF-7F10494411F03A24F24-1D24">
      Modify
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-03DA8271-7DC3-40EB-AE69-AA553B074F6D">
       gp:drawOutline
      </samp>
      by making the changes shown in boldface in the following code (don't overlook the addition of the
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-98004826-55B6-4B6E-8F3F-626358335575">
       polyPoints
      </samp>
      local variable to the
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-133FCFB2-6452-4107-AFD4-9C5AD1DA5F1B">
       defun
      </samp>
      statement):
      <pre class="pre codeblock prettyprint">(defun gp:drawOutline (BoundaryData / PathAngle
                                      Width HalfWidth StartPt PathLength
                                      angm90 angp90 p1 p2
                                      p3 p4 poly2Dpoints
                                      poly3Dpoints plineStyle pline
                                      polyPoints
                      )
  ;; extract the values from the list BoundaryData.
  (setq PathAngle    (cdr (assoc 50 BoundaryData))
        Width        (cdr (assoc 40 BoundaryData))
        HalfWidth    (/ Width 2.00)
        StartPt      (cdr (assoc 10 BoundaryData))
        PathLength   (cdr (assoc 41 BoundaryData))
        angp90       (+ PathAngle (Degrees-&gt;Radians 90))
        angm90       (- PathAngle (Degrees-&gt;Radians 90))
        p1           (polar StartPt angm90 HalfWidth)
        p2           (polar p1 PathAngle PathLength)
        p3           (polar p2 angp90 Width)
        p4           (polar p3 (+ PathAngle 
                       (Degrees-&gt;Radians 180)) PathLength)
        poly2Dpoints (apply 'append
                       (mapcar '3dPoint-&gt;2dPoint (list p1 p2 p3 p4))
                     )
        poly3Dpoints (mapcar 'float (append p1 p2 p3 p4))

        ;; get the polyline style.
        plineStyle   (strcase (cdr (assoc 4 BoundaryData)))

        ;; Add polyline to the model space using ActiveX automation.
        pline        (if (= plineStyle "LIGHT")
                       ;; create a lightweight polyline.
                       (vla-addLightweightPolyline
                         *ModelSpace*   ; Global Definition for Model Space
                         (gp:list-&gt;variantArray poly2Dpoints)
                         ;data conversion
                       ) ;_ end of vla-addLightweightPolyline
                       ;; or create a regular polyline.
                       (vla-addPolyline
                         *ModelSpace*
                         (gp:list-&gt;variantArray poly3Dpoints)
                         ;data conversion
                       ) ;_ end of vla-addPolyline
                     ) ;_ end of if
        polyPoints   (list
                       (cons 12 p1)
                       (cons 13 p2)
                       (cons 14 p3)
                       (cons 15 p4)
                     )
  ) ;_ end of setq

  (vla-put-closed pline T)
  (list pline polyPoints)
) ;_ end of defun</pre>
     </li>
     <li class="li" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF-7F10494411F03A24F24-1D23">
      Modify the
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-6F4ADA48-043E-4F07-ADCB-3376F85F9791">
       C:GPath
      </samp>
      function (in
      <em class="ph i" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-C0FF6F2F-21F1-4251-8656-C477AA11C1F2">
       gpmain.lsp
      </em>
      ). Look for the line of code that currently looks like this:
      <pre class="pre codeblock prettyprint">(setq PolylineName (gp:drawOutline gp_PathData))</pre>
      <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-788D">
       Change it so it appears as follows:
      </p>
      <pre class="pre codeblock prettyprint">(setq PolylineList     (gp:drawOutline gp_PathData)
      PolylineName     (car PolylineList)
      gp_pathData      (append gp_pathData (cadr PolylineList))
 ) ;_ end of setq</pre>
      <p class="p" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WSFACF1429558A55DE1929BBDFEF458CE1C-788C">
       The
       <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-C7ED7F35-45B1-41A0-BD6D-6261B2FE5754">
        gp_PathData
       </samp>
       variable now carries all the information required by the reactor function.
      </p>
     </li>
     <li class="li" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__WS1A9193826455F5FF-7F10494411F03A24F24-1D22">
      Add
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-AD558EEE-DFE9-44CA-ADD2-3BB224FA8711">
       PolylineList
      </samp>
      to the local variables section of the
      <samp class="ph codeph" id="GUID-0AB3F77F-A1A3-444D-8EC4-5B99B0DBC855__GUID-AFEE41CC-A71B-4E27-9BA5-65D8BAA121B1">
       C:GPath
      </samp>
      function definition.
     </li>
    </ol>
   </div>
  </div>
  <div class="related-links">
   <div class="familylinks">
    <div class="parentlink">
     <strong>
      Parent topic:
     </strong>
     <a class="link" href="Lesson_7_Putting_It_All_Together_Visual_LISP_IDE.html">
      Lesson 7: Putting It All Together (Visual LISP IDE)
     </a>
    </div>
    <div class="previouslink">
     <strong>
      Previous topic:
     </strong>
     <a class="link" href="Reacting_to_More_User_Invoked_Commands.html">
      Reacting to More User-Invoked Commands
     </a>
    </div>
    <div class="nextlink">
     <strong>
      Next topic:
     </strong>
     <a class="link" href="Adding_the_New_Reactor_Functionality.html">
      Adding the New Reactor Functionality
     </a>
    </div>
   </div>
  </div>
 </body>
</html>
