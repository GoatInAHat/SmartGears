<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="concept" name="topic-type"/>
  <meta content="/view/OARX/2025/ENU/" name="helpsystempath"/>
  <meta content="OARX" name="product"/>
  <meta content="2025" name="release"/>
  <meta content="Developer" name="book"/>
  <meta content="AutoCAD-AutoLISP-Tutorials" name="component"/>
  <meta content="25/4/2024" name="created"/>
  <meta content="ACD=2025" name="applies-to"/>
  <meta content="ACAD_E=2025" name="applies-to"/>
  <meta content="AMECH_PP=2025" name="applies-to"/>
  <meta content="ARCHDESK=2025" name="applies-to"/>
  <meta content="BLDSYS=2025" name="applies-to"/>
  <meta content="CIV3D=2025" name="applies-to"/>
  <meta content="MAP=2025" name="applies-to"/>
  <meta content="PLNT3D=2025" name="applies-to"/>
  <meta content="PNID=2025" name="applies-to"/>
  <meta content="STRDET=2025" name="applies-to"/>
  <meta content="UTLDESN=2025" name="applies-to"/>
  <meta content="CSY, DEU, ESP, FRA, HUN, ITA, KOR, PLK, PTB, RUS, CHS, CHT" name="applies-to-languages"/>
  <meta content="TRIDION" name="generatedby"/>
  <meta content="disable" name="user-comments"/>
  <meta content="GUID-209318DE-95C4-40F6-8776-935C8905FDEE" name="workflow-parent-id"/>
  <meta content="general" name="experiencelevel"/>
  <meta content="programmer" name="audience"/>
  <meta content="02/12/2019" name="modified"/>
  <meta content="autolisp" name="topic-subtype"/>
  <meta content="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5" name="topicid"/>
  <meta content="ENU" name="language"/>
  <title>
   Handling Nonlinear Reactor Sequences
  </title>
  <link href="../../../../_assets/client-28da4093.css" rel="stylesheet" type="text/css"/>
 </head>
 <body id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5">
  <div class="head">
   <div class="head-block">
    <div class="button-info">
     <span id="infoline">
     </span>
    </div>
    <div class="ancestry">
    </div>
    <div class="head-text">
     <h1>
      Handling Nonlinear Reactor Sequences
     </h1>
    </div>
   </div>
  </div>
  <div class="body conbody">
   <div class="section" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__GUID-B1A75A52-09E0-4E6B-B695-5E03ED76FABC">
    <p class="p" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WSFACF1429558A55DE1929BBDFEF458CE1C-787A">
     The final important detail deals with a quirk in the command/reactor sequence in AutoCAD when users modify a polyline by using the specialized GRIP commands. These commands, such as GRIP_MOVE and GRIP_ROTATE, are available from a shortcut menu after you select the grip of an object and right-click. The reactor sequence is not as linear as a simple MOVE or ERASE command. In effect, the user is changing to a different command while in the midst of another. To demonstrate this situation, you can load the code from Lesson 6 that traces the sequence of reactor events. Or simply review the following annotated Visual LISP Console window output to see what happens:
    </p>
    <pre class="pre codeblock prettyprint">;; To start, select the polyline and some of the circles by using a 
;; crossing selection box. The items in the selection set-- 
;; the chosen circles and the polyline--are now shown with grips on.
;; To initiate the sequence, click on one of the polyline grips:
(GP:COMMAND-WILL-START #&lt;VLR-Command-reactor&gt; (GRIP_STRETCH))

;; Now change the command to a move by right-clicking and choosing
;; MOVE from the pop-up menu.  Notice that the command-ended
;; reactor fires in order to close out the GRIP_STRETCH command
;; without having fired an object reactor event:
(GP:COMMAND-ENDED #&lt;VLR-Command-reactor&gt; (GRIP_STRETCH))
(GP:COMMAND-WILL-START #&lt;VLR-Command-reactor&gt; (GRIP_MOVE))

;; Now drag the outline (and the selected circles) to a new location.
(GP:OUTLINE-CHANGED #&lt;VLA-OBJECT IAcadLWPolyline 028f3188&gt; 
                 #&lt;VLR-Object-reactor&gt; nil)
(GP:COMMAND-ENDED #&lt;VLR-Command-reactor&gt; (GRIP_MOVE))</pre>
    <p class="p" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WSFACF1429558A55DE1929BBDFEF458CE1C-7879">
     This demonstrates that you cannot be certain your object reactor callbacks will be called in all cases.
    </p>
    <p class="p" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WSFACF1429558A55DE1929BBDFEF458CE1C-7878">
     There is a related quirk in this sequence. Even during the final command-ended callback, the circles that are still part of the grip selection set cannot be deleted. These circles are still open by AutoCAD. If you attempt to erase them during the command-ended callback, you can crash AutoCAD. To get around this, you can use another global variable to store a list of pointers to the tile objects until they can be deleted.
    </p>
   </div>
   <div class="section" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WSFACF1429558A55DE6C92BAFEE30F7510-7DB8">
    <h2 class="title sectiontitle">
     To process nonlinear reactor sequences
    </h2>
    <ol class="ol" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WS1A9193826455F5FF18CB41610EC0A2E719-72E1">
     <li class="li" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WS1A9193826455F5FF-7F10494411F03A24F24-1D19">
      Add the following function to the
      <em class="ph i" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__GUID-8E2727F6-FA4C-4DCF-AAF6-D65503D5644E">
       gpreact.lsp
      </em>
      file:
      <pre class="pre codeblock prettyprint">(defun gp:erase-tiles (reactor / reactorData tiles tile)
  (if (setq reactorData (vlr-data reactor))
    (progn
      ;; Tiles in the path are stored as data in the reactor.
      (setq tiles (cdr (assoc 100 reactorData)))
      ;; Erase all the existing tiles in the path.
      (foreach tile tiles
          (if (and (null (member tile *Safe-to-Delete*))
                 (not (vlax-erased-p tile))
                 )
              (progn
                 (vla-put-visible tile 0)
                 (setq *Safe-to-Delete* (cons tile *Safe-to-Delete*))
              )
          )
      )
      (vlr-data-set reactor nil)
      ) 
    )
 )</pre>
      <p class="p" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WSFACF1429558A55DE1929BBDFEF458CE1C-7877">
       This new function will be used in the first phase of erasing tiles. Notice that the tiles are not actually erased: they are made invisible and are added to a global variable named
       <samp class="ph codeph" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__GUID-C9889421-F4BD-4B6C-AD83-B2BC0F8C6DE8">
        *Safe-to-Delete*
       </samp>
       .
      </p>
     </li>
     <li class="li" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WS1A9193826455F5FF-7F10494411F03A24F24-1D18">
      Add the following function to the
      <em class="ph i" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__GUID-951F3024-19E5-4BA6-AB55-FC8BA7F99C5A">
       gpreact.lsp
      </em>
      file:
      <pre class="pre codeblock prettyprint">(defun Gp:Safe-Delete (activeCommand)
  (if (not (equal
      (strcase (substr activeCommand 1 5))
        "GRIP_"
      )
  )
  (progn
     (if *Safe-to-Delete*
        (foreach Item *Safe-to-Delete*
          (if (not (vlax-erased-p Item))
            (vla-erase item)
          )
        )
      )
      (setq *Safe-to-Delete* nil)
      )
    )
 )</pre>
      <p class="p" id="GUID-A0D4D264-BA45-4600-B7E1-D09ADAA1A1B5__WSFACF1429558A55DE1929BBDFEF458CE1C-7876">
       This function can be invoked at a time when a GRIP_MOVE or GRIP_STRETCH command is not being executed.
      </p>
     </li>
    </ol>
   </div>
  </div>
  <div class="related-links">
   <div class="familylinks">
    <div class="parentlink">
     <strong>
      Parent topic:
     </strong>
     <a class="link" href="Lesson_7_Putting_It_All_Together_Visual_LISP_IDE.html">
      Lesson 7: Putting It All Together (Visual LISP IDE)
     </a>
    </div>
    <div class="previouslink">
     <strong>
      Previous topic:
     </strong>
     <a class="link" href="Using_ActiveX_Methods_in_Reactor_Callback_Functions.html">
      Using ActiveX Methods in Reactor Callback Functions
     </a>
    </div>
    <div class="nextlink">
     <strong>
      Next topic:
     </strong>
     <a class="link" href="Coding_the_Command_ended_Function.html">
      Coding the Command-ended Function
     </a>
    </div>
   </div>
  </div>
 </body>
</html>
